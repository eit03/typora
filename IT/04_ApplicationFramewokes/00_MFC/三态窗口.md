

```
#pragma once
#include "afxwin.h"
class CTristateWnd :
    public CWnd
{
    //*****************************************************************************************************************
    //Prepare ******************************************************************************************************
    
    //*****************************************************************************************************************
    //Properties ***************************************************************************************************
    public:
    protected:
    private:
        BOOL m_bHasBeenPressed;
        BOOL m_bIsHovering;
        BOOL m_bIsNormal;

        CImage m_img;
        CStringW m_wcsImgName;
        HBITMAP m_hBm;

        enum TristateFlags { HOVER = 0, PRESSED, NORMAL };
    
    //*****************************************************************************************************************
    //Constructor **************************************************************************************************
public:
    CTristateWnd(CStringW wcsImgName);
    ~CTristateWnd();
    protected:
    private:
    
    //*****************************************************************************************************************
    //Functions ****************************************************************************************************
    public:
    protected:
    private:
    
    //*****************************************************************************************************************
    //**************************************************************************************************************


public:
    virtual BOOL PreCreateWindow(CREATESTRUCT& cs);
    DECLARE_MESSAGE_MAP()
    afx_msg void OnLButtonUp(UINT nFlags, CPoint point);
    afx_msg void OnLButtonDown(UINT nFlags, CPoint point);
    afx_msg void OnMouseHover(UINT nFlags, CPoint point);
    afx_msg void OnMouseLeave();
    afx_msg void OnMouseMove(UINT nFlags, CPoint point);
    afx_msg int OnCreate(LPCREATESTRUCT lpCreateStruct);
    afx_msg void OnPaint();
};
```



```
#include "stdafx.h"
#include "TristateWnd.h"
#include "Resource.h"


CTristateWnd::CTristateWnd(CStringW wcsImgName)
{
    m_bHasBeenPressed = 0;
    m_bIsHovering = 0;
    m_bIsNormal = 1;

    m_wcsImgName = wcsImgName;
}


CTristateWnd::~CTristateWnd()
{
}


BOOL CTristateWnd::PreCreateWindow(CREATESTRUCT& cs)
{
    // TODO: Add your specialized code here and/or call the base class
    //0.Design window class
    HINSTANCE hInstance = AfxGetInstanceHandle();
    assert(hInstance);

    WNDCLASSEXW wc{};
    wc.cbSize = sizeof(WNDCLASSEXW);

    BOOL bRet = GetClassInfoExW(hInstance, cs.lpszClass, &wc);
    if (bRet)
        return true;


    wc.hbrBackground = (HBRUSH)GetStockObject(LTGRAY_BRUSH);
    wc.hCursor = LoadCursor(NULL, IDC_ARROW);
    wc.hIcon = wc.hIconSm = LoadIcon(NULL, IDI_APPLICATION);
    wc.hInstance = hInstance;
    wc.lpfnWndProc = AfxWndProc;
    wc.lpszClassName = cs.lpszClass;
    wc.style = CS_VREDRAW | CS_HREDRAW | CS_DBLCLKS;

    //1.Register window class
    bRet = (BOOL)RegisterClassExW(&wc);
    assert(bRet);

    return true;
}
BEGIN_MESSAGE_MAP(CTristateWnd, CWnd)
    ON_WM_LBUTTONUP()
    ON_WM_LBUTTONDOWN()
    ON_WM_MOUSEHOVER()
    ON_WM_MOUSELEAVE()
    ON_WM_MOUSEMOVE()
    ON_WM_CREATE()
    ON_WM_PAINT()
END_MESSAGE_MAP()


void CTristateWnd::OnLButtonDown(UINT nFlags, CPoint point)
{
    // TODO: Add your message handler code here and/or call default
    m_bIsHovering = 0;
    m_bHasBeenPressed = 1;
    m_bIsNormal = 0;
    
    Invalidate();

    CWnd::OnLButtonDown(nFlags, point);
}


void CTristateWnd::OnLButtonUp(UINT nFlags, CPoint point)
{
    // TODO: Add your message handler code here and/or call default
    m_bIsHovering = 1;
    m_bHasBeenPressed = 0;
    m_bIsNormal = 0;

    Invalidate();

    CWnd::OnLButtonUp(nFlags, point);
}


void CTristateWnd::OnMouseHover(UINT nFlags, CPoint point)
{
    // TODO: Add your message handler code here and/or call default
    m_bIsHovering = 1;
    m_bHasBeenPressed = 0;
    m_bIsNormal = 0;

    Invalidate();

    CWnd::OnMouseHover(nFlags, point);
}


void CTristateWnd::OnMouseLeave()
{
    // TODO: Add your message handler code here and/or call default
    m_bIsHovering = 0;
    m_bHasBeenPressed = 0;
    m_bIsNormal = 1;

    Invalidate();

    CWnd::OnMouseLeave();
}


void CTristateWnd::OnMouseMove(UINT nFlags, CPoint point)
{
    // TODO: Add your message handler code here and/or call default
    TRACKMOUSEEVENT tme{};
    tme.cbSize = sizeof(TRACKMOUSEEVENT);
    tme.dwFlags = TME_HOVER | TME_LEAVE;
    tme.hwndTrack = m_hWnd;
    tme.dwHoverTime = 10;
    TrackMouseEvent(&tme);

    CWnd::OnMouseMove(nFlags, point);
}


int CTristateWnd::OnCreate(LPCREATESTRUCT lpCreateStruct)
{
    if (CWnd::OnCreate(lpCreateStruct) == -1)
        return -1;

    // TODO:  Add your specialized creation code here
    if (m_img.IsNull())
    {
        m_img.LoadFromResource(AfxGetInstanceHandle(), IDBM_TRISTATE);
        assert(!m_img.IsNull());
        
        m_wcsImgName = L"";
    }

    return 0;
}


void CTristateWnd::OnPaint()
{
    CPaintDC dc(this); // device context for painting
                       // TODO: Add your message handler code here
                       // Do not call CWnd::OnPaint() for painting messages
    BOOL bRet{};
    int iTristateFlag = 0;     

    CRect rtClnt;
    GetClientRect(rtClnt);
    int iHFactor = rtClnt.Width();
    int iVFactor = rtClnt.Height();

    if (m_bIsHovering)
        iTristateFlag = HOVER;
    else if (m_bHasBeenPressed)
        iTristateFlag = PRESSED;
    else
        iTristateFlag = NORMAL;

    CRect rtImg(iHFactor * iTristateFlag, 0, iHFactor * (iTristateFlag + 1), iVFactor);
    m_img.Draw(dc, rtClnt, rtImg);
}
```

