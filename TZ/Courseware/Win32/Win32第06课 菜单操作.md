***
`Version:`
`Declaration:` 
`Defination:` 
`Reference:` 
`Keyword:` Menus		About Menus
***
[TOC]
***


# `1. 概念`
## `1.1 什么是菜单`
> A **menu** is a list of items that specify options or groups of options (a submenu) for an application. Clicking a menu item opens a submenu or causes the application to carry out a command. 

> 菜单是为应用程序指定选项或选项组(子菜单)的项目列表。单击菜单项将打开子菜单或使应用程序执行命令。

菜单是菜单项的集合;菜单项分为==命令菜单项==与==非命令菜单项==.



##`1.2 什么是菜单栏`
> A menu is arranged in a hierarchy. At the top level of the hierarchy is the **menu bar** .

> 菜单是按层次排列的,在层次结构的顶层是菜单栏.

## `1.3. 菜单分类`

### `1.3.1 顶层菜单 top-level menu` 

> A menu bar is sometimes called a **top-level menu** .

> 菜单栏有时被称为**顶层菜单**.

在标题栏下的**顶层菜单**一般是程序的**主菜单**.


### `1.3.2 窗口菜单 The Window Menu`

> The Window menu (also known as the System menu or Control menu) is a pop-up menu defined and managed almost exclusively by the operating system. The user can open the window menu by clicking the application icon on the title bar or by right-clicking anywhere on the title bar.

> 窗口菜单(也称为系统菜单或控件菜单)是一个弹出式菜单，几乎完全由操作系统定义和管理。用户可以通过单击标题栏上的应用程序图标或右键单击标题栏中的任何位置来打开窗口菜单。

**窗口菜单**一般被称为**系统菜单**.

### `1.3.3 上下文菜单 Context Menu`

> The system also provides shortcut menus. A shortcut menu is not attached to the menu bar; it can appear anywhere on the screen. An application typically associates a shortcut menu with a portion of a window, such as the client area, or with a specific object, such as an icon. For this reason, these menus are also called context menus.

> 系统还提供快捷菜单。**快捷菜单**是不附在菜单栏上;它可以出现在屏幕的任何地方。应用程序通常将快捷菜单与窗口的一部分关联起来，例如客户端区域，或与特定对象(例如图标)相关联。出于这个原因，这类菜单也被称为上下文菜单.

**快捷菜单**是不附在菜单栏上;

应用程序通常将快捷菜单与窗口的一部分关联起来,这类菜单也被称为**上下文菜单**.

## `1.4 下拉菜单 drop-down menu`
> An item on the menu bar almost always opens a menu. Menu bars rarely contain command items. A menu opened from the menu bar drops down from the menu bar and is sometimes called a drop-down menu. When a drop-down menu is displayed, it is attached to the menu bar. A menu item on the menu bar that opens a drop-down menu is also called a menu name.

> 菜单栏上的一个项目几乎总是打开一个菜单。菜单栏很少包含命令项。从菜单栏中打开的菜单从菜单栏中掉下来，有时被称为**下拉菜单**。当显示一个下拉菜单时，它会附加到菜单栏。菜单栏中打开下拉菜单的菜单项也称为菜单名称.

从菜单栏中打开的菜单,且附加到菜单栏,被称为**下拉菜单**.

##`1.5 弹出菜单 pop-up menus`

> A menu is arranged in a hierarchy. At the top level of the hierarchy is the menu bar; which contains a list of menus, which in turn can contain submenus. A menu bar is sometimes called a top-level menu, and the menus and submenus are also known as **pop-up menus**.

> 菜单是按层次结构排列的。层次结构的顶层是菜单栏;其中包含菜单列表，而菜单又可以包含子菜单。菜单栏有时被称为顶级菜单，菜单和子菜单也称为**弹出菜单**。

一个菜单栏的菜单项和子菜单被称为**弹出菜单**。



# `2. 主菜单添加方式`
主菜单有二个种添加方式:
- 资源方式
- 代码方式
## `2.1 资源方式`

1. 资源视图
2. 工程上右键
3. 添加 --> 资源
4. 菜单 --> 新建
5. 修改菜单ID
6. 设计你的菜单
7. 在WM_CREATE中,加载菜单,设置主菜单
```
HMENU hMainMenu = LoadMenu(hInst, MAKEINTRESOURCE(IDMENU_MAIN));
assert(hMainMenu);
SetMenu(hWnd, hMainMenu);
```
8. 在相应的命令菜单项上右键,添加事件处理器,选择正确位置
9. 写响应代码

## `2.2 代码方式`

在WM_CREATE中,加载菜单,设置主菜单:

```
HMENU hNCIPlayRelated = CreatePopupMenu(); //设计播放相关项
assert(hNCIPlayRelated);
assert(AppendMenu(hNCIPlayRelated, MF_STRING, 0x8002, L"Pl&ay")); //添加播放项
assert(AppendMenu(hNCIPlayRelated, MF_SEPARATOR, 0, 0)); //添加分隔符
assert(AppendMenu(hNCIPlayRelated, MF_STRING, 0x8003, L"&Prev")); //上一曲
assert(AppendMenu(hNCIPlayRelated, MF_STRING, 0x8004, L"&Next")); //下一曲

HMENU hMainMenu = CreateMenu(); //创建主菜单
assert(hMainMenu);

assert(AppendMenu(hMainMenu, MF_STRING, 0x8000, L"&SelectDirectory")); //添加选择目录
assert(AppendMenu(hMainMenu, MF_POPUP, (UINT)hNCIPlayRelated, L"&PlayRelated")); //添加播放相关项

SetMenu(hWnd, hMainMenu); //设置主菜单
```

菜单命令响应:
```
case WM_COMMAND:
{
    bool bIsMenuFlag = (0 == HIWORD(wParam));
    int id = LOWORD(wParam);
   
    if (bIsMenuFlag)
    {
        if (id == 0x8000)
        {
            MessageBox(hWnd, L"0x8000", L"", MB_OK);
            break;
        }
        else if (id == 0x8002)
        {
            MessageBox(hWnd, L"0x8002", L"", MB_OK);
            break;
        }
        else if (id == 0x8003)
        {
            MessageBox(hWnd, L"0x8003", L"", MB_OK);
            break;
        }
        else if (id == 0x8004)
        {
            MessageBox(hWnd, L"0x8004", L"", MB_OK);
            break;
        }
    }

}break;
```

##  `2.3 注意`
&File           --> f是热键.
Fi&le           --> l是热键.
Fil&e           --> e是热键.
播放相关(&b)    --> b是热键

# `3. 上下文菜单`

上下文菜单有二个种添加方式:

* 资源方式
* 代码方式

## `3.1 资源方式`
1. 资源视图
2. 工程上右键
3. 添加 --> 资源
4. 菜单 --> 新建
5. 修改菜单ID
6. 设计你的菜单
7. 代码
```
case WM_CONTEXTMENU:
{
    HMENU hContxMenu = LoadMenu(g_hInst, MAKEINTRESOURCE(IDMENU_MAIN_CONTEXT)); //加载上下文菜单
    assert(hContxMenu);
    hContxMenu = GetSubMenu(hContxMenu, 0); //得到上下文菜单第一项
    assert(hContxMenu);

    int xPos = LOWORD(lParam);
    int yPos = HIWORD(lParam);
    TrackPopupMenuEx(hContxMenu, TPM_LEFTALIGN, xPos, yPos, hWnd, 0); //弹出上下文菜单
}break;
```


## `3.2 代码方式`

```
case WM_CONTEXTMENU:
{
    HMENU hNCIPlayRelated = CreatePopupMenu(); //设计播放相关项
    assert(hNCIPlayRelated);
    assert(AppendMenu(hNCIPlayRelated, MF_STRING, 0x8002, L"Pl&ay")); //添加播放项
    assert(AppendMenu(hNCIPlayRelated, MF_SEPARATOR, 0, 0)); //添加分隔符
    assert(AppendMenu(hNCIPlayRelated, MF_STRING, 0x8003, L"&Prev")); //上一曲
    assert(AppendMenu(hNCIPlayRelated, MF_STRING, 0x8004, L"&Next")); //下一曲

    HMENU hMainMenu = CreatePopupMenu(); //创建上下文菜单
    assert(hMainMenu);

    assert(AppendMenu(hMainMenu, MF_STRING, 0x8000, L"&SelectDirectory")); //添加选择目录
    assert(AppendMenu(hMainMenu, MF_POPUP, (UINT)hNCIPlayRelated, L"&PlayRelated")); //添加播放相关项

    int xPos = LOWORD(lParam);
    int yPos = HIWORD(lParam);
    TrackPopupMenuEx(hMainMenu, TPM_LEFTALIGN, xPos, yPos, hWnd, 0); //弹出上下文菜单
}break;
```

# `4. 重要函数`

| Funs            | Description  |
| --------------- | ------------ |
| LoadMenu        | 加载资源菜单 |
| SetMenu         | 设置主菜单   |
| CreateMenu      | 创建菜单     |
| CreatePopupMenu | 创建弹出菜单 |
| AppendMenu      | 附加菜单     |
| GetSubMenu      | 得到子菜单   |
| TrackPopupMenu  | 跟踪弹出菜单 |




# `5. 作业`

把上一课按钮的功能用菜单实现. (必做)